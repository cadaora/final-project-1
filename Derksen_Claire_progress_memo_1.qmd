---
title: "Progress Memo 1"
subtitle: |
  | Final Project 
  | Data Science 1 with R (STAT 301-1)
author: "Claire Derksen"
date: today

format:
  html:
    toc: true
    embed-resources: true
    
execute:
  echo: false
  warning: false

from: markdown+emoji 
---

```{r}
#| label: load-pkgs
# Loading package(s)
library(tidyverse)
library(naniar)
library(janitor)
library(readxl)
```



::: {.callout-tip icon=false}

## Github Repo Link

[https://github.com/stat301-1-2023-fall/final-project-1-cadaora](https://github.com/stat301-1-2023-fall/final-project-1-cadaora)

:::


## Data source

I am using data from the National Survey on Drug Use and Health (NSDUH) for 2020^[[https://www.datafiles.samhsa.gov/dataset/national-survey-drug-use-and-health-2020-nsduh-2020-ds0001](https://www.datafiles.samhsa.gov/dataset/national-survey-drug-use-and-health-2020-nsduh-2020-ds0001)] and 2019^[[https://www.datafiles.samhsa.gov/dataset/national-survey-drug-use-and-health-2019-nsduh-2019-ds0001](https://www.datafiles.samhsa.gov/dataset/national-survey-drug-use-and-health-2019-nsduh-2019-ds0001)]. It is a survey conducted by the Substance Abuse and Mental Health Administration (SAMSHA) of people aged 12 and older in the United States. It covers topics including mental health and substance use. Due to methodology changes including web-based interviewing, the 2020 and 2019 NSDUH data may be hard to compare. However, SAMSHA provided a comparability chart that shows what variables are compatible between 2019 and 2020.

## Why this data

I'm interested in exploring what societal factors can impact drug use. I'd like to particularly focus on college students since that's applicable to my life. It'd be interesting to see if there was any particular increase in drug use during the start of the COVID-19 pandemic caused by the isolation of quarantine. Since the survey also tracks mental health topics I could also explore any changes in the mental health of college students during the pandemic.

## Data quality & complexity check
Most of the variables are integers that would need to be interpreted using the code book. The original 2020 file had 32893 observations and 2890 variables. The previous year, 2019, had 56136 observations and 2741 variables. After filtering only college students we had 3337 observations in the 2020 dataset and 6136 observations in the 2019 dataset.

I started with assessing missingness in the 2020 college dataset.
```{r}
#| label: load-datasets
#| eval: false
NSDUH_2020 <-read.delim(file="data/NSDUH_2020_Tab.txt")
NSDUH_2019 <-read.delim(file="data/NSDUH_2019_Tab.txt")
```

```{r}
#| label: write-filtered-college-datasets
#| eval: false
NSDUH_2020 %>%
  filter(EDUSCHGRD2==9|EDUSCHGRD2==10|EDUSCHGRD2==11) %>%
  write_rds(file="data/NSDUH_2020_college.rds")


NSDUH_2019 %>%
  filter(EDUSCHGRD2==9|EDUSCHGRD2==10|EDUSCHGRD2==11) %>%
  write_rds(file="data/NSDUH_2019_college.rds")
```

```{r}
#| label: import from smaller college datasets (faster load)
NSDUH_2020_college <- read_rds(file="data/NSDUH_2020_college.rds")
NSDUH_2019_college <- read_rds(file="data/NSDUH_2019_college.rds")
```

```{r}
#| label: 2020 missingness-pt1
miss_var_summary(NSDUH_2020_college) %>% slice_head(n=10)

```

Just looking at missingness there seems to be a considerable amount of data missing. However, looking at the codebook helps us understand why certain variables have no data.
```{r}
#| label: 2020 missingness-pt2
NSDUH_2020_college <-NSDUH_2020_college %>%
  select(!SCHFELT:RLGFRND & 
           !YHOSP:YMHASPTX & 
           !YMDELT:YMDEIMSD5YR)
NSDUH_2020_college %>%
  miss_var_summary() %>%
  slice_head(n=10)

  
```
The 2020 codebook reveals the variables with at or near 100% missingness were reserved for people under 18, so our data set of college students will have little to no values for those variables. For the remaining variables with a high proportion of missingness I will have to look through the code book in order to determine whether the data is worth keeping. 

## Potential data issues
In order to eliminate non-comparable variables I imported the excel comparability column for 2019-2020 using readxl and converted it into a list. After removing the non-comparable variables, there were still many variables with a high portion of missingness. I decided to continue looking through the codebook to decipher why they are missing. 

One issue I encountered was noticed was processing time. It takes a long time for the >100MB .txt files to load. I solved this by creating two new .rds files for each year in order to shorten future loading times.

I'll need to merge the two datasets. The most tedious part will be turning the integer variables into factor variables using the code book so it's better to not have a ton of variables. (Explain general code 999). 



## Misc

 I then used the list to select what variables to keep. After that I assessed missingness again.
```{r}
#| label: compatability
comparability <- read_excel("data/RDAS_Comparability.xlsx") %>%
  filter(!is.na(`2019-2020`)) %>%
  select(Variable) %>%
  deframe()

NSDUH_2020_college <-NSDUH_2020_college %>%
  select(any_of(comparability))

miss_var_summary(NSDUH_2020_college)
```

